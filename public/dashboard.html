<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Axon - Live Traffic Monitor</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            body {
                font-family: "Monaco", "Courier New", monospace;
                background: #0a0e27;
                color: #00ff41;
                padding: 20px;
            }
            .header {
                text-align: center;
                margin-bottom: 30px;
                padding: 20px;
                border-bottom: 2px solid #00ff41;
            }
            .header-logo {
                height: 80px;
                width: auto;
                vertical-align: middle;
                margin: 0 15px;
                border-radius: 8px;
            }
            h1 {
                font-size: 2.5em;
                text-shadow: 0 0 10px #00ff41;
                display: flex;
                align-items: center;
                justify-content: center;
                margin-bottom: 10px;
            }
            .lightning {
                font-size: 80px;
                line-height: 80px;
            }
            .stats {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 20px;
                margin-bottom: 30px;
            }
            .stat-card {
                background: rgba(0, 255, 65, 0.1);
                border: 1px solid #00ff41;
                padding: 20px;
                border-radius: 8px;
            }
            .stat-value {
                font-size: 2em;
                font-weight: bold;
            }
            .stat-label {
                font-size: 0.9em;
                opacity: 0.7;
            }
            .feed {
                background: rgba(0, 0, 0, 0.5);
                border: 1px solid #00ff41;
                padding: 20px;
                height: 400px;
                overflow-y: auto;
                font-size: 0.9em;
                line-height: 1.8;
            }
            .feed-item {
                margin-bottom: 5px;
                opacity: 0;
                animation: fadeIn 0.5s forwards;
            }
            @keyframes fadeIn {
                to {
                    opacity: 1;
                }
            }
            .attack {
                color: #ff4444;
            }
            .legit {
                color: #00ff41;
            }
            .suspicious {
                color: #ffaa00;
            }
            .connection-status {
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 10px 20px;
                border-radius: 5px;
                font-size: 0.9em;
            }
            .connected {
                background: #00ff41;
                color: #0a0e27;
            }
            .disconnected {
                background: #ff4444;
                color: white;
            }
        </style>
    </head>
    <body>
        <div id="status" class="connection-status disconnected">
            âš« Disconnected
        </div>

        <div class="header">
            <h1>
                <span class="lightning">âš¡</span>
                <img src="Axon_logo.jpg" alt="Axon" class="header-logo" />
                <span class="lightning">âš¡</span>
            </h1>
            <p>Neural Traffic Classification System</p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="total-requests">0</div>
                <div class="stat-label">Total Requests</div>
            </div>
            <div class="stat-card">
                <div class="stat-value attack" id="attack-count">0</div>
                <div class="stat-label">Attacks Blocked</div>
            </div>
            <div class="stat-card">
                <div class="stat-value legit" id="legit-count">0</div>
                <div class="stat-label">Legitimate Traffic</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="requests-per-min">0</div>
                <div class="stat-label">Requests/Min</div>
            </div>
        </div>

        <h2 style="margin-bottom: 10px">ðŸ“¡ Live Traffic Feed</h2>
        <div class="feed" id="feed">
            <div style="opacity: 0.5">Waiting for traffic...</div>
        </div>

        <script>
            // Replace with your actual Worker URL
            const WS_URL = "wss://axon.your-subdomain.workers.dev/ws";

            let ws;
            let stats = {
                total: 0,
                attacks: 0,
                legit: 0,
                recentRequests: [],
            };

            function connect() {
                ws = new WebSocket(WS_URL);

                ws.onopen = () => {
                    console.log("Connected to Axon");
                    document.getElementById("status").textContent =
                        "ðŸŸ¢ Connected";
                    document.getElementById("status").className =
                        "connection-status connected";
                };

                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    handleMessage(data);
                };

                ws.onclose = () => {
                    console.log("Disconnected from Axon");
                    document.getElementById("status").textContent =
                        "âš« Disconnected";
                    document.getElementById("status").className =
                        "connection-status disconnected";
                    // Reconnect after 3 seconds
                    setTimeout(connect, 3000);
                };

                ws.onerror = (error) => {
                    console.error("WebSocket error:", error);
                };
            }

            function handleMessage(data) {
                // Handle different message types
                switch (data.type) {
                    case "connected":
                        handleConnectionConfirmation(data);
                        break;
                    case "classification":
                        handleTrafficUpdate(data);
                        break;
                    case "pong":
                        console.log("Pong received");
                        break;
                    case "stats":
                        console.log("Stats:", data);
                        break;
                    case "error":
                        console.error("Server error:", data.message);
                        break;
                    default:
                        // Legacy messages without type field
                        if (data.prediction) {
                            handleTrafficUpdate(data);
                        }
                }
            }

            function handleConnectionConfirmation(data) {
                console.log("Connected with session ID:", data.session_id);
                // Clear the "waiting for traffic" message
                const feed = document.getElementById("feed");
                feed.innerHTML = "";
            }

            function handleTrafficUpdate(data) {
                const feed = document.getElementById("feed");

                // Update stats
                stats.total++;
                if (data.prediction === "attack") {
                    stats.attacks++;
                } else {
                    stats.legit++;
                }

                // Track for requests/min
                stats.recentRequests.push(Date.now());
                // Keep only last minute
                const oneMinAgo = Date.now() - 60000;
                stats.recentRequests = stats.recentRequests.filter(
                    (t) => t > oneMinAgo,
                );

                // Update stat cards
                document.getElementById("total-requests").textContent =
                    stats.total;
                document.getElementById("attack-count").textContent =
                    stats.attacks;
                document.getElementById("legit-count").textContent =
                    stats.legit;
                document.getElementById("requests-per-min").textContent =
                    stats.recentRequests.length;

                // Add to feed
                const icon = data.prediction === "attack" ? "ðŸ”´" : "ðŸŸ¢";
                const className = data.prediction;
                const confidence = Math.round(data.confidence * 100);

                const item = document.createElement("div");
                item.className = `feed-item ${className}`;
                item.textContent = `${icon} ${data.method} ${data.path} | ${data.prediction.toUpperCase()} (${confidence}%) | ${data.country} | ${data.ip}`;

                // Add to top of feed
                feed.insertBefore(item, feed.firstChild);

                // Keep only last 50 items
                while (feed.children.length > 50) {
                    feed.removeChild(feed.lastChild);
                }
            }

            // Connect on load
            connect();
        </script>
    </body>
</html>
